<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("visualization", "1", {packages: ['corechart', 'bar']});
    google.setOnLoadCallback(drawTopicsChart);
    google.setOnLoadCallback(drawDisciplinesChart);

    function drawTopicsChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topic');
        data.addColumn('number', 'Count');

        data.addRows([
            {% for row in topic_counts %}
                ['{{ row.name }}'.replace(/&amp;/g, '&'), {{ row.count }}]{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]);
        data.sort([{column: 1, desc: true}]);
        var max_value = data.getColumnRange(1).max;

        var chartHeight = data.getNumberOfRows() * 25 + 80;

        var tick_count;
        if (max_value <= 4) {
            tick_count = max_value + 1;
        }
        else {
            tick_count = 6
        }

        var options = {
            title: "Summary by Topic",
            height: chartHeight,
            hAxis: {
                viewWindow: {
                    min: 0,
                    max: max_value
                },
                format: '0',
                gridlines: {
                    count: tick_count
                }
            },
            legend: {
                position: 'none'
            },
            chartArea: {
                left: '20%'
            },
            series: {
                0:{color: '#6BBC49'}
            }
        };
        var chart = new google.visualization.BarChart(document.getElementById('by_topic'));
        chart.draw(data, options);
    }


    function drawDisciplinesChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Discipline');
        data.addColumn('number', 'Count');

        data.addRows([
            {% for row in discipline_counts %}
                ['{{ row.name }}'.replace(/&amp;/g, '&'), {{ row.count }}]{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]);
        data.sort([{column: 1, desc: true}]);
        var max_value = data.getColumnRange(1).max;

        var chartHeight = data.getNumberOfRows() * 25 + 80;

        var tick_count;
        if (max_value <= 4) {
            tick_count = max_value + 1;
        }
        else {
            tick_count = 7
        }

        var options = {
            title: "Summary by Discipline",
            height: chartHeight,
            hAxis: {
                viewWindow: {
                    min: 0,
                    max: max_value
                },
                format: '0',
                gridlines: {
                    count: tick_count
                }
            },
            legend: {
                position: 'none'
            },
            chartArea: {
                left: '20%'
            },
            series: {
                0:{color: '#6BBC49'}
            }
        };
        var chart = new google.visualization.BarChart(document.getElementById('by_discipline'));
        chart.draw(data, options);
    }
</script>